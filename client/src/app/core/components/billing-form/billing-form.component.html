<header>
  <h1>New Invoice</h1>
</header>

<div #formContainer class="form-container" (scroll)="($event)">
  <form (ngSubmit)="onSubmit()" [formGroup]="form">
    <fieldset>
      <legend>bill from</legend>

      <div formGroupName="senderAddress" class="fields-container sender">
        <div
          class="form-field sender-street"
          [class.invalid]="senderStreet?.invalid && senderStreet?.touched"
        >
          <label for="sender-street">street address</label>
          <span *ngIf="senderStreet?.invalid"> can't be emtpy </span>
          <input id="sender-street" formControlName="street" />
        </div>

        <div
          class="form-field sender-city"
          [class.invalid]="senderCity?.invalid && senderCity?.touched"
        >
          <label for="sender-city">city</label>
          <input id="sender-city" formControlName="city" />
        </div>

        <div
          class="form-field sender-post-code"
          [class.invalid]="senderPostCode?.invalid && senderPostCode?.touched"
        >
          <label for="sender-post-code">post code</label>
          <input id="sender-post-code" formControlName="postCode" />
        </div>

        <div
          class="form-field sender-country"
          [class.invalid]="senderCountry?.invalid && senderCountry?.touched"
        >
          <label for="sender-country">country</label>
          <input id="sender-country" formControlName="country" />
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>bill to</legend>

      <div class="fields-container client-initials">
        <div
          class="form-field client-name"
          [class.invalid]="clientName?.invalid && clientName?.touched"
        >
          <label for="client-name">client's name</label>
          <span *ngIf="clientName?.invalid"> can't be emtpy </span>
          <input id="client-name" formControlName="clientName" />
        </div>

        <div
          class="form-field client-email"
          [class.invalid]="clientEmail?.invalid && clientEmail?.touched"
        >
          <label for="client-email">client's email</label>
          <span *ngIf="clientEmail?.hasError('required')">can't be empty</span>
          <span *ngIf="clientEmail?.touched && clientEmail?.errors?.['email']">
            invalid email format
          </span>
          <input id="client-email" formControlName="clientEmail" />
        </div>
      </div>
      <div formGroupName="clientAddress" class="fields-container client">
        <div
          class="form-field client-street"
          [class.invalid]="clientStreet?.invalid && clientStreet?.touched"
        >
          <label for="client-street">street address</label>
          <span *ngIf="clientStreet?.invalid">can't be empty</span>
          <input id="client-street" formControlName="street" />
        </div>

        <div
          class="form-field client-city"
          [class.invalid]="clientCity?.invalid && clientCity?.touched"
        >
          <label for="client-city">city</label>
          <input id="client-city" formControlName="city" />
        </div>

        <div
          class="form-field client-post-code"
          [class.invalid]="clientPostCode?.invalid && clientPostCode?.touched"
        >
          <label for="client-post-code">post code</label>
          <input id="client-post-code" formControlName="postCode" />
        </div>

        <div
          class="form-field client-country"
          [class.invalid]="clientCountry?.invalid && clientCountry?.touched"
        >
          <label for="client-country">country</label>
          <input id="client-country" formControlName="country" />
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>item list</legend>
      <div class="fields-container conditions">
        <div class="form-field invoice-date">
          <label for="invoice-date">invoice date</label>
          <input type="date" id="invoice-date" formControlName="createdAt" />
        </div>
        <div class="form-field payment-terms">
          <label for="payment-terms">payment terms</label>
          <select
            id="payment-terms"
            name="payment-terms"
            formControlName="paymentTerms"
          >
            <option value="1">Next 1 day</option>
            <option value="7">Next 7 days</option>
            <option value="14">Next 14 days</option>
            <option value="30">Next 30 days</option>
          </select>
        </div>
        <div class="form-field description">
          <label for="description">project description</label>
          <input
            id="description"
            placeholder="e.g Graphic Design Service"
            formControlName="description"
          />
        </div>
      </div>
    </fieldset>

    <fieldset class="items-list">
      <legend class="legend-title">items list</legend>
      <div formArrayName="items" class="list">
        <div class="list-thead">
          <div>item name</div>
          <div>qty.</div>
          <div>price</div>
          <div>total</div>
        </div>
        <div
          *ngFor="let item of items.controls; let i = index"
          [formGroupName]="i"
          class="fields-container list-item"
        >
          <div
            class="form-field"
            [class.invalid]="
              item.get('name')?.invalid && item.get('name')?.touched
            "
          >
            <label for="item-name">item name</label>
            <input id="item-name" formControlName="name" />
          </div>
          <div
            class="form-field"
            [class.invalid]="
              item.get('quantity')?.invalid && item.get('quantity')?.touched
            "
          >
            <label for="quantity">qty.</label>
            <input
              id="quantity"
              type="number"
              placeholder="0"
              formControlName="quantity"
            />
          </div>
          <div
            class="form-field"
            [class.invalid]="
              item.get('price')?.invalid && item.get('price')?.touched
            "
          >
            <label for="price">price</label>
            <input
              id="price"
              type="number"
              placeholder="0.00"
              formControlName="price"
            />
          </div>
          <div class="form-field">
            <label>total</label>
            <div class="item-total">
              {{ calculateItemTotal(i) | currency: '':'' }}
            </div>
          </div>
          <div class="delete-button">
            <button type="button" (click)="deleteItem(i)">
              <svg-icon src="assets/icons/icon-delete.svg"></svg-icon>
            </button>
          </div>
        </div>
      </div>
      <app-button
        class="add-button"
        [type]="'button'"
        [variant]="'light'"
        (click)="addItem()"
      >
        + add new item
      </app-button>
    </fieldset>

    <div *ngIf="!valid" class="validation-errors">
      <div>- All fields must be added</div>
      <div *ngIf="!items.length">- An item should be added</div>
    </div>

    <div class="panel" [class.accent]="!scrolledToBottom">
      <app-button [variant]="'light'" [small]="true" (click)="discardForm()">
        Discard
      </app-button>
      <div class="panel-right">
        <app-button (click)="saveAsDraft()" [variant]="'dark'" [small]="true">
          Save as Draft
        </app-button>
        <app-button [small]="true" (click)="onSubmit()">
          Save & Send
        </app-button>
      </div>
    </div>
  </form>
</div>
